<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Haskell Programming - Chapter 26</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Haskell Programming</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
            </div>
        </div>

        <div id="content">
            <h1>Chapter 26</h1>

            <hr />
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE InstanceSigs #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# LANGUAGE StandaloneDeriving #-}</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">{-# LANGUAGE UndecidableInstances #-}</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">module</span> <span class="dt">Chapter26</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">import</span> <span class="dt">Control.Monad</span> (guard)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">import</span> <span class="dt">Control.Monad.IO.Class</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">import</span> <span class="dt">Control.Monad.Trans.Class</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">import</span> <span class="dt">Control.Monad.Trans.Except</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">import</span> <span class="dt">Control.Monad.Trans.Maybe</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">import</span> <span class="dt">Data.Bifunctor</span> (first)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="kw">import</span> <span class="dt">Data.Functor</span> (($&gt;))</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw">import</span> <span class="dt">Data.Functor.Identity</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="kw">import</span> <span class="dt">Data.IORef</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Map</span> <span class="kw">as</span> <span class="dt">M</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw">import</span> <span class="dt">Data.Text.Lazy</span> (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text.Lazy</span> <span class="kw">as</span> <span class="dt">TL</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw">import</span> <span class="dt">System.Environment</span> (getArgs)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="kw">import</span> <span class="dt">Test.Hspec</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="kw">import</span> <span class="dt">Test.Hspec.Checkers</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="kw">import</span> <span class="dt">Test.QuickCheck</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="kw">import</span> <span class="dt">Test.QuickCheck.Checkers</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="kw">import</span> <span class="dt">Test.QuickCheck.Classes</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="kw">import</span> <span class="dt">Web.Scotty.Trans</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="kw">newtype</span> <span class="dt">EitherT</span> e m a <span class="fu">=</span> <span class="dt">EitherT</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29">  {<span class="ot"> runEitherT ::</span> m (<span class="dt">Either</span> e a)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  }</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="kw">deriving</span> <span class="kw">instance</span> <span class="dt">Eq</span> (m (<span class="dt">Either</span> e a)) <span class="ot">=&gt;</span> <span class="dt">Eq</span> (<span class="dt">EitherT</span> e m a)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="kw">deriving</span> <span class="kw">instance</span> <span class="dt">Show</span> (m (<span class="dt">Either</span> e a)) <span class="ot">=&gt;</span> <span class="dt">Show</span> (<span class="dt">EitherT</span> e m a)</a>
<a class="sourceLine" id="cb1-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="kw">instance</span> <span class="dt">Arbitrary</span> (m (<span class="dt">Either</span> e a)) <span class="ot">=&gt;</span> <span class="dt">Arbitrary</span> (<span class="dt">EitherT</span> e m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">  arbitrary <span class="fu">=</span> <span class="dt">EitherT</span> <span class="fu">&lt;$&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="kw">instance</span> <span class="dt">Eq</span> (m (<span class="dt">Either</span> e a)) <span class="ot">=&gt;</span> <span class="dt">EqProp</span> (<span class="dt">EitherT</span> e m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40">  (<span class="fu">=-=</span>) <span class="fu">=</span> eq</a>
<a class="sourceLine" id="cb1-41" data-line-number="41"></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="kw">instance</span> <span class="dt">Functor</span> m <span class="ot">=&gt;</span> <span class="dt">Functor</span> (<span class="dt">EitherT</span> e m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="ot">  fmap ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m a <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m b</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">  fmap f (<span class="dt">EitherT</span> mea) <span class="fu">=</span> <span class="dt">EitherT</span> <span class="fu">$</span> (fmap <span class="fu">.</span> fmap) f mea</a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="kw">instance</span> <span class="dt">Applicative</span> m <span class="ot">=&gt;</span> <span class="dt">Applicative</span> (<span class="dt">EitherT</span> e m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47">  pure <span class="fu">=</span> <span class="dt">EitherT</span> <span class="fu">.</span> pure <span class="fu">.</span> pure</a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="ot">  (&lt;*&gt;) ::</span> <span class="dt">EitherT</span> e m (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m a <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m b</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">  <span class="dt">EitherT</span> fab <span class="fu">&lt;*&gt;</span> <span class="dt">EitherT</span> meea <span class="fu">=</span> <span class="dt">EitherT</span> <span class="fu">$</span> fmap (<span class="fu">&lt;*&gt;</span>) fab <span class="fu">&lt;*&gt;</span> meea</a>
<a class="sourceLine" id="cb1-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Monad</span> (<span class="dt">EitherT</span> e m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52">  return <span class="fu">=</span> pure</a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="ot">  (&gt;&gt;=) ::</span> <span class="dt">EitherT</span> e m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m b) <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m b</a>
<a class="sourceLine" id="cb1-54" data-line-number="54">  <span class="dt">EitherT</span> mea <span class="fu">&gt;&gt;=</span> f <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55">    <span class="dt">EitherT</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56">      ea <span class="ot">&lt;-</span> mea</a>
<a class="sourceLine" id="cb1-57" data-line-number="57">      <span class="kw">case</span> ea <span class="kw">of</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58">        <span class="dt">Left</span> e <span class="ot">-&gt;</span> return <span class="fu">$</span> <span class="dt">Left</span> e</a>
<a class="sourceLine" id="cb1-59" data-line-number="59">        <span class="dt">Right</span> a <span class="ot">-&gt;</span> runEitherT <span class="fu">$</span> f a</a>
<a class="sourceLine" id="cb1-60" data-line-number="60"></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"><span class="kw">instance</span> <span class="dt">MonadTrans</span> (<span class="dt">EitherT</span> e) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62"><span class="ot">  lift ::</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> m a <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m a</a>
<a class="sourceLine" id="cb1-63" data-line-number="63">  lift <span class="fu">=</span> <span class="dt">EitherT</span> <span class="fu">.</span> fmap <span class="dt">Right</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64"></a>
<a class="sourceLine" id="cb1-65" data-line-number="65"><span class="kw">instance</span> <span class="dt">MonadIO</span> m <span class="ot">=&gt;</span> <span class="dt">MonadIO</span> (<span class="dt">EitherT</span> e m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66"><span class="ot">  liftIO ::</span> <span class="dt">IO</span> a <span class="ot">-&gt;</span> <span class="dt">EitherT</span> e m a</a>
<a class="sourceLine" id="cb1-67" data-line-number="67">  liftIO <span class="fu">=</span> lift <span class="fu">.</span> liftIO</a>
<a class="sourceLine" id="cb1-68" data-line-number="68"></a>
<a class="sourceLine" id="cb1-69" data-line-number="69"><span class="ot">swapEitherT ::</span> <span class="dt">Functor</span> m <span class="ot">=&gt;</span> <span class="dt">EitherT</span> e m a <span class="ot">-&gt;</span> <span class="dt">EitherT</span> a m e</a>
<a class="sourceLine" id="cb1-70" data-line-number="70">swapEitherT (<span class="dt">EitherT</span> mea) <span class="fu">=</span> <span class="dt">EitherT</span> <span class="fu">$</span> swapEither <span class="fu">&lt;$&gt;</span> mea</a>
<a class="sourceLine" id="cb1-71" data-line-number="71">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-72" data-line-number="72">    swapEither (<span class="dt">Left</span> e) <span class="fu">=</span> <span class="dt">Right</span> e</a>
<a class="sourceLine" id="cb1-73" data-line-number="73">    swapEither (<span class="dt">Right</span> a) <span class="fu">=</span> <span class="dt">Left</span> a</a>
<a class="sourceLine" id="cb1-74" data-line-number="74"></a>
<a class="sourceLine" id="cb1-75" data-line-number="75"><span class="ot">eitherT ::</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> m c) <span class="ot">-&gt;</span> (b <span class="ot">-&gt;</span> m c) <span class="ot">-&gt;</span> <span class="dt">EitherT</span> a m b <span class="ot">-&gt;</span> m c</a>
<a class="sourceLine" id="cb1-76" data-line-number="76">eitherT f g (<span class="dt">EitherT</span> mab) <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-77" data-line-number="77">  ab <span class="ot">&lt;-</span> mab</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">  <span class="kw">case</span> ab <span class="kw">of</span></a>
<a class="sourceLine" id="cb1-79" data-line-number="79">    <span class="dt">Left</span> a <span class="ot">-&gt;</span> f a</a>
<a class="sourceLine" id="cb1-80" data-line-number="80">    <span class="dt">Right</span> b <span class="ot">-&gt;</span> g b</a>
<a class="sourceLine" id="cb1-81" data-line-number="81"></a>
<a class="sourceLine" id="cb1-82" data-line-number="82"><span class="kw">newtype</span> <span class="dt">ReaderT</span> r m a <span class="fu">=</span> <span class="dt">ReaderT</span></a>
<a class="sourceLine" id="cb1-83" data-line-number="83">  {<span class="ot"> runReaderT ::</span> r <span class="ot">-&gt;</span> m a</a>
<a class="sourceLine" id="cb1-84" data-line-number="84">  }</a>
<a class="sourceLine" id="cb1-85" data-line-number="85"></a>
<a class="sourceLine" id="cb1-86" data-line-number="86"><span class="kw">instance</span> (<span class="dt">Monoid</span> r, <span class="dt">Show</span> r, <span class="dt">Show</span> (m a)) <span class="ot">=&gt;</span> <span class="dt">Show</span> (<span class="dt">ReaderT</span> r m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-87" data-line-number="87">  show (<span class="dt">ReaderT</span> rma) <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-88" data-line-number="88">    <span class="st">&quot;ReaderT called with '&quot;</span> <span class="fu">++</span> show r <span class="fu">++</span> <span class="st">&quot;' is '&quot;</span> <span class="fu">++</span> show (rma r) <span class="fu">++</span> <span class="st">&quot;'&quot;</span></a>
<a class="sourceLine" id="cb1-89" data-line-number="89">    <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-90" data-line-number="90">      r <span class="fu">=</span> mempty</a>
<a class="sourceLine" id="cb1-91" data-line-number="91"></a>
<a class="sourceLine" id="cb1-92" data-line-number="92"><span class="kw">instance</span> (<span class="dt">Arbitrary</span> (m a), <span class="dt">CoArbitrary</span> r) <span class="ot">=&gt;</span> <span class="dt">Arbitrary</span> (<span class="dt">ReaderT</span> r m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-93" data-line-number="93">  arbitrary <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">&lt;$&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb1-94" data-line-number="94"></a>
<a class="sourceLine" id="cb1-95" data-line-number="95"><span class="kw">instance</span> (<span class="dt">Arbitrary</span> r, <span class="dt">EqProp</span> (m a), <span class="dt">Show</span> r) <span class="ot">=&gt;</span> <span class="dt">EqProp</span> (<span class="dt">ReaderT</span> r m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-96" data-line-number="96">  <span class="dt">ReaderT</span> rma <span class="fu">=-=</span> <span class="dt">ReaderT</span> rma' <span class="fu">=</span> rma <span class="fu">=-=</span> rma'</a>
<a class="sourceLine" id="cb1-97" data-line-number="97"></a>
<a class="sourceLine" id="cb1-98" data-line-number="98"><span class="kw">instance</span> <span class="dt">Functor</span> m <span class="ot">=&gt;</span> <span class="dt">Functor</span> (<span class="dt">ReaderT</span> r m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-99" data-line-number="99"><span class="ot">  fmap ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m a <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m b</a>
<a class="sourceLine" id="cb1-100" data-line-number="100">  fmap f (<span class="dt">ReaderT</span> rma) <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">$</span> (fmap <span class="fu">.</span> fmap) f rma</a>
<a class="sourceLine" id="cb1-101" data-line-number="101"></a>
<a class="sourceLine" id="cb1-102" data-line-number="102"><span class="kw">instance</span> <span class="dt">Applicative</span> m <span class="ot">=&gt;</span> <span class="dt">Applicative</span> (<span class="dt">ReaderT</span> r m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-103" data-line-number="103">  pure <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">.</span> pure <span class="fu">.</span> pure</a>
<a class="sourceLine" id="cb1-104" data-line-number="104"><span class="ot">  (&lt;*&gt;) ::</span> <span class="dt">ReaderT</span> r m (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m a <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m b</a>
<a class="sourceLine" id="cb1-105" data-line-number="105">  <span class="dt">ReaderT</span> fmab <span class="fu">&lt;*&gt;</span> <span class="dt">ReaderT</span> rma <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">$</span> fmap (<span class="fu">&lt;*&gt;</span>) fmab <span class="fu">&lt;*&gt;</span> rma</a>
<a class="sourceLine" id="cb1-106" data-line-number="106"></a>
<a class="sourceLine" id="cb1-107" data-line-number="107"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Monad</span> (<span class="dt">ReaderT</span> r m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-108" data-line-number="108">  return <span class="fu">=</span> pure</a>
<a class="sourceLine" id="cb1-109" data-line-number="109"><span class="ot">  (&gt;&gt;=) ::</span> <span class="dt">ReaderT</span> r m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m b) <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m b</a>
<a class="sourceLine" id="cb1-110" data-line-number="110">  <span class="dt">ReaderT</span> rma <span class="fu">&gt;&gt;=</span> aRrmb <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-111" data-line-number="111">    <span class="dt">ReaderT</span> <span class="fu">$</span> \r <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-112" data-line-number="112">      a <span class="ot">&lt;-</span> rma r</a>
<a class="sourceLine" id="cb1-113" data-line-number="113">      runReaderT (aRrmb a) r</a>
<a class="sourceLine" id="cb1-114" data-line-number="114"></a>
<a class="sourceLine" id="cb1-115" data-line-number="115"><span class="kw">instance</span> <span class="dt">MonadTrans</span> (<span class="dt">ReaderT</span> r) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-116" data-line-number="116"><span class="ot">  lift ::</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> m a <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m a</a>
<a class="sourceLine" id="cb1-117" data-line-number="117">  lift <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">.</span> const</a>
<a class="sourceLine" id="cb1-118" data-line-number="118"></a>
<a class="sourceLine" id="cb1-119" data-line-number="119"><span class="kw">instance</span> <span class="dt">MonadIO</span> m <span class="ot">=&gt;</span> <span class="dt">MonadIO</span> (<span class="dt">ReaderT</span> r m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-120" data-line-number="120"><span class="ot">  liftIO ::</span> <span class="dt">IO</span> a <span class="ot">-&gt;</span> <span class="dt">ReaderT</span> r m a</a>
<a class="sourceLine" id="cb1-121" data-line-number="121">  liftIO <span class="fu">=</span> lift <span class="fu">.</span> liftIO</a>
<a class="sourceLine" id="cb1-122" data-line-number="122"></a>
<a class="sourceLine" id="cb1-123" data-line-number="123"><span class="kw">newtype</span> <span class="dt">StateT</span> s m a <span class="fu">=</span> <span class="dt">StateT</span></a>
<a class="sourceLine" id="cb1-124" data-line-number="124">  {<span class="ot"> runStateT ::</span> s <span class="ot">-&gt;</span> m (a, s)</a>
<a class="sourceLine" id="cb1-125" data-line-number="125">  }</a>
<a class="sourceLine" id="cb1-126" data-line-number="126"></a>
<a class="sourceLine" id="cb1-127" data-line-number="127"><span class="kw">instance</span> (<span class="dt">Monoid</span> s, <span class="dt">Show</span> s, <span class="dt">Show</span> (m (a, s))) <span class="ot">=&gt;</span> <span class="dt">Show</span> (<span class="dt">StateT</span> s m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-128" data-line-number="128">  show (<span class="dt">StateT</span> sma) <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-129" data-line-number="129">    <span class="st">&quot;StateT called with '&quot;</span> <span class="fu">++</span> show s <span class="fu">++</span> <span class="st">&quot;' is '&quot;</span> <span class="fu">++</span> show (sma s) <span class="fu">++</span> <span class="st">&quot;'&quot;</span></a>
<a class="sourceLine" id="cb1-130" data-line-number="130">    <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-131" data-line-number="131">      s <span class="fu">=</span> mempty</a>
<a class="sourceLine" id="cb1-132" data-line-number="132"></a>
<a class="sourceLine" id="cb1-133" data-line-number="133"><span class="kw">instance</span> (<span class="dt">Arbitrary</span> s, <span class="dt">EqProp</span> (m (a, s)), <span class="dt">Show</span> s) <span class="ot">=&gt;</span> <span class="dt">EqProp</span> (<span class="dt">StateT</span> s m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-134" data-line-number="134">  <span class="dt">StateT</span> sma <span class="fu">=-=</span> <span class="dt">StateT</span> sma' <span class="fu">=</span> sma <span class="fu">=-=</span> sma'</a>
<a class="sourceLine" id="cb1-135" data-line-number="135"></a>
<a class="sourceLine" id="cb1-136" data-line-number="136"><span class="kw">instance</span> (<span class="dt">CoArbitrary</span> s, <span class="dt">Arbitrary</span> (m (a, s))) <span class="ot">=&gt;</span> <span class="dt">Arbitrary</span> (<span class="dt">StateT</span> s m a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-137" data-line-number="137">  arbitrary <span class="fu">=</span> <span class="dt">StateT</span> <span class="fu">&lt;$&gt;</span> arbitrary</a>
<a class="sourceLine" id="cb1-138" data-line-number="138"></a>
<a class="sourceLine" id="cb1-139" data-line-number="139"><span class="kw">instance</span> <span class="dt">Functor</span> m <span class="ot">=&gt;</span> <span class="dt">Functor</span> (<span class="dt">StateT</span> s m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-140" data-line-number="140"><span class="ot">  fmap ::</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m a <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m b</a>
<a class="sourceLine" id="cb1-141" data-line-number="141">  fmap f (<span class="dt">StateT</span> sma) <span class="fu">=</span> <span class="dt">StateT</span> <span class="fu">$</span> (fmap <span class="fu">.</span> fmap) (first f) sma</a>
<a class="sourceLine" id="cb1-142" data-line-number="142"></a>
<a class="sourceLine" id="cb1-143" data-line-number="143"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Applicative</span> (<span class="dt">StateT</span> s m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-144" data-line-number="144">  pure a <span class="fu">=</span> <span class="dt">StateT</span> <span class="fu">$</span> \s <span class="ot">-&gt;</span> pure (a, s)</a>
<a class="sourceLine" id="cb1-145" data-line-number="145"><span class="ot">  (&lt;*&gt;) ::</span> <span class="dt">StateT</span> s m (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m a <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m b</a>
<a class="sourceLine" id="cb1-146" data-line-number="146">  <span class="dt">StateT</span> smab <span class="fu">&lt;*&gt;</span> <span class="dt">StateT</span> sma <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-147" data-line-number="147">    <span class="dt">StateT</span> <span class="fu">$</span> \s <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-148" data-line-number="148">      (ab, s') <span class="ot">&lt;-</span> smab s</a>
<a class="sourceLine" id="cb1-149" data-line-number="149">      (a, s'') <span class="ot">&lt;-</span> sma s'</a>
<a class="sourceLine" id="cb1-150" data-line-number="150">      return (ab a, s'')</a>
<a class="sourceLine" id="cb1-151" data-line-number="151"></a>
<a class="sourceLine" id="cb1-152" data-line-number="152"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Monad</span> (<span class="dt">StateT</span> s m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-153" data-line-number="153">  return <span class="fu">=</span> pure</a>
<a class="sourceLine" id="cb1-154" data-line-number="154"><span class="ot">  (&gt;&gt;=) ::</span> <span class="dt">StateT</span> s m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m b) <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m b</a>
<a class="sourceLine" id="cb1-155" data-line-number="155">  <span class="dt">StateT</span> sma <span class="fu">&gt;&gt;=</span> aSsmb <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-156" data-line-number="156">    <span class="dt">StateT</span> <span class="fu">$</span> \s <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-157" data-line-number="157">      (a, s') <span class="ot">&lt;-</span> sma s</a>
<a class="sourceLine" id="cb1-158" data-line-number="158">      runStateT (aSsmb a) s'</a>
<a class="sourceLine" id="cb1-159" data-line-number="159"></a>
<a class="sourceLine" id="cb1-160" data-line-number="160"><span class="kw">instance</span> <span class="dt">MonadTrans</span> (<span class="dt">StateT</span> s) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-161" data-line-number="161"><span class="ot">  lift ::</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> m a <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m a</a>
<a class="sourceLine" id="cb1-162" data-line-number="162">  lift ma <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-163" data-line-number="163">    <span class="dt">StateT</span> <span class="fu">$</span> \s <span class="ot">-&gt;</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-164" data-line-number="164">      a <span class="ot">&lt;-</span> ma</a>
<a class="sourceLine" id="cb1-165" data-line-number="165">      return (a, s)</a>
<a class="sourceLine" id="cb1-166" data-line-number="166"></a>
<a class="sourceLine" id="cb1-167" data-line-number="167"><span class="kw">instance</span> <span class="dt">MonadIO</span> m <span class="ot">=&gt;</span> <span class="dt">MonadIO</span> (<span class="dt">StateT</span> s m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-168" data-line-number="168"><span class="ot">  liftIO ::</span> <span class="dt">IO</span> a <span class="ot">-&gt;</span> <span class="dt">StateT</span> s m a</a>
<a class="sourceLine" id="cb1-169" data-line-number="169">  liftIO <span class="fu">=</span> lift <span class="fu">.</span> liftIO</a>
<a class="sourceLine" id="cb1-170" data-line-number="170"></a>
<a class="sourceLine" id="cb1-171" data-line-number="171"><span class="ot">embedded ::</span> <span class="dt">MaybeT</span> (<span class="dt">ExceptT</span> <span class="dt">String</span> (<span class="dt">ReaderT</span> () <span class="dt">IO</span>)) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb1-172" data-line-number="172"><span class="co">--embedded = ??? (const (Right (Just 1)))</span></a>
<a class="sourceLine" id="cb1-173" data-line-number="173">embedded <span class="fu">=</span> <span class="dt">MaybeT</span> (<span class="dt">ExceptT</span> (<span class="dt">ReaderT</span> (const (pure (<span class="dt">Right</span> (<span class="dt">Just</span> <span class="dv">1</span>))))))</a>
<a class="sourceLine" id="cb1-174" data-line-number="174"></a>
<a class="sourceLine" id="cb1-175" data-line-number="175"><span class="ot">rDec ::</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> <span class="dt">ReaderT</span> a <span class="dt">Identity</span> a</a>
<a class="sourceLine" id="cb1-176" data-line-number="176">rDec <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">$</span> <span class="dt">Identity</span> <span class="fu">.</span> flip (<span class="fu">-</span>) <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-177" data-line-number="177"></a>
<a class="sourceLine" id="cb1-178" data-line-number="178"><span class="ot">rShow ::</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> <span class="dt">ReaderT</span> a <span class="dt">Identity</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb1-179" data-line-number="179">rShow <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">$</span> <span class="dt">Identity</span> <span class="fu">.</span> show</a>
<a class="sourceLine" id="cb1-180" data-line-number="180"></a>
<a class="sourceLine" id="cb1-181" data-line-number="181"><span class="ot">rPrintAndInc ::</span> (<span class="dt">Num</span> a, <span class="dt">Show</span> a) <span class="ot">=&gt;</span> <span class="dt">ReaderT</span> a <span class="dt">IO</span> a</a>
<a class="sourceLine" id="cb1-182" data-line-number="182">rPrintAndInc <span class="fu">=</span> <span class="dt">ReaderT</span> <span class="fu">$</span> \r <span class="ot">-&gt;</span> putStrLn (<span class="st">&quot;Hi: &quot;</span> <span class="fu">++</span> show r) <span class="fu">$&gt;</span> (r <span class="fu">+</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-183" data-line-number="183"></a>
<a class="sourceLine" id="cb1-184" data-line-number="184"><span class="ot">sPrintAndAccum ::</span> (<span class="dt">Num</span> a, <span class="dt">Show</span> a) <span class="ot">=&gt;</span> <span class="dt">StateT</span> a <span class="dt">IO</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb1-185" data-line-number="185">sPrintAndAccum <span class="fu">=</span> <span class="dt">StateT</span> <span class="fu">$</span> \s <span class="ot">-&gt;</span> putStrLn (<span class="st">&quot;Hi: &quot;</span> <span class="fu">++</span> show s) <span class="fu">$&gt;</span> (show s, s <span class="fu">+</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-186" data-line-number="186"></a>
<a class="sourceLine" id="cb1-187" data-line-number="187"><span class="co">{- &quot;Fix the code&quot; -}</span></a>
<a class="sourceLine" id="cb1-188" data-line-number="188"><span class="ot">isValid ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb1-189" data-line-number="189">isValid v <span class="fu">=</span> <span class="ch">'!'</span> <span class="ot">`elem`</span> v</a>
<a class="sourceLine" id="cb1-190" data-line-number="190"></a>
<a class="sourceLine" id="cb1-191" data-line-number="191"><span class="ot">maybeExcite ::</span> <span class="dt">MaybeT</span> <span class="dt">IO</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb1-192" data-line-number="192">maybeExcite <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-193" data-line-number="193">  v <span class="ot">&lt;-</span> liftIO getLine</a>
<a class="sourceLine" id="cb1-194" data-line-number="194">  guard <span class="fu">$</span> isValid v</a>
<a class="sourceLine" id="cb1-195" data-line-number="195">  return v</a>
<a class="sourceLine" id="cb1-196" data-line-number="196"></a>
<a class="sourceLine" id="cb1-197" data-line-number="197"><span class="ot">doExcite ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb1-198" data-line-number="198">doExcite <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-199" data-line-number="199">  putStrLn <span class="st">&quot;say something excite!&quot;</span></a>
<a class="sourceLine" id="cb1-200" data-line-number="200">  excite <span class="ot">&lt;-</span> runMaybeT maybeExcite</a>
<a class="sourceLine" id="cb1-201" data-line-number="201">  <span class="kw">case</span> excite <span class="kw">of</span></a>
<a class="sourceLine" id="cb1-202" data-line-number="202">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> putStrLn <span class="st">&quot;MOAR EXCITE&quot;</span></a>
<a class="sourceLine" id="cb1-203" data-line-number="203">    <span class="dt">Just</span> e <span class="ot">-&gt;</span> putStrLn (<span class="st">&quot;Good, was very excite: &quot;</span> <span class="fu">++</span> e)</a>
<a class="sourceLine" id="cb1-204" data-line-number="204"></a>
<a class="sourceLine" id="cb1-205" data-line-number="205"><span class="co">{- &quot;Hit counter&quot; -}</span></a>
<a class="sourceLine" id="cb1-206" data-line-number="206"><span class="kw">data</span> <span class="dt">Config</span> <span class="fu">=</span> <span class="dt">Config</span></a>
<a class="sourceLine" id="cb1-207" data-line-number="207">  {<span class="ot"> counts ::</span> <span class="dt">IORef</span> (<span class="dt">M.Map</span> <span class="dt">Text</span> <span class="dt">Integer</span>)</a>
<a class="sourceLine" id="cb1-208" data-line-number="208">  ,<span class="ot"> prefix ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb1-209" data-line-number="209">  }</a>
<a class="sourceLine" id="cb1-210" data-line-number="210"></a>
<a class="sourceLine" id="cb1-211" data-line-number="211"><span class="kw">type</span> <span class="dt">Scotty</span> <span class="fu">=</span> <span class="dt">ScottyT</span> <span class="dt">Text</span> (<span class="dt">ReaderT</span> <span class="dt">Config</span> <span class="dt">IO</span>)</a>
<a class="sourceLine" id="cb1-212" data-line-number="212"></a>
<a class="sourceLine" id="cb1-213" data-line-number="213"><span class="kw">type</span> <span class="dt">Handler</span> <span class="fu">=</span> <span class="dt">ActionT</span> <span class="dt">Text</span> (<span class="dt">ReaderT</span> <span class="dt">Config</span> <span class="dt">IO</span>)</a>
<a class="sourceLine" id="cb1-214" data-line-number="214"></a>
<a class="sourceLine" id="cb1-215" data-line-number="215"><span class="ot">bumpBoomp ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">M.Map</span> <span class="dt">Text</span> <span class="dt">Integer</span> <span class="ot">-&gt;</span> (<span class="dt">M.Map</span> <span class="dt">Text</span> <span class="dt">Integer</span>, <span class="dt">Integer</span>)</a>
<a class="sourceLine" id="cb1-216" data-line-number="216">bumpBoomp k m <span class="fu">=</span> (M.insert k count m, count)</a>
<a class="sourceLine" id="cb1-217" data-line-number="217">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-218" data-line-number="218">    count <span class="fu">=</span> M.findWithDefault <span class="dv">0</span> k m <span class="fu">+</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-219" data-line-number="219"></a>
<a class="sourceLine" id="cb1-220" data-line-number="220"><span class="ot">app ::</span> <span class="dt">Scotty</span> ()</a>
<a class="sourceLine" id="cb1-221" data-line-number="221"><span class="co">-- app ~ Scotty () ~ ScottyT e m () ~ ScottyT Text (ReaderT Config IO) ()</span></a>
<a class="sourceLine" id="cb1-222" data-line-number="222">app <span class="fu">=</span></a>
<a class="sourceLine" id="cb1-223" data-line-number="223">  get <span class="st">&quot;/:key&quot;</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb1-224" data-line-number="224">   <span class="co">-- block is ~ ActionT e m () ~ ActionT Text (ReaderT Config IO) ()</span></a>
<a class="sourceLine" id="cb1-225" data-line-number="225">   <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-226" data-line-number="226">    unprefixed <span class="ot">&lt;-</span> param <span class="st">&quot;key&quot;</span></a>
<a class="sourceLine" id="cb1-227" data-line-number="227">    config <span class="ot">&lt;-</span> lift (<span class="dt">ReaderT</span> return)</a>
<a class="sourceLine" id="cb1-228" data-line-number="228">    <span class="kw">let</span> key' <span class="fu">=</span> mappend (prefix config) unprefixed</a>
<a class="sourceLine" id="cb1-229" data-line-number="229">    newInteger <span class="ot">&lt;-</span> liftIO <span class="fu">$</span> atomicModifyIORef' (counts config) (bumpBoomp key')</a>
<a class="sourceLine" id="cb1-230" data-line-number="230">    html <span class="fu">$</span></a>
<a class="sourceLine" id="cb1-231" data-line-number="231">      mconcat [<span class="st">&quot;&lt;h1&gt;Success! Count was: &quot;</span>, TL.pack <span class="fu">$</span> show newInteger, <span class="st">&quot;&lt;/h1&gt;&quot;</span>]</a>
<a class="sourceLine" id="cb1-232" data-line-number="232"></a>
<a class="sourceLine" id="cb1-233" data-line-number="233"><span class="ot">main' ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb1-234" data-line-number="234">main' <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-235" data-line-number="235">  [prefixArg] <span class="ot">&lt;-</span> getArgs</a>
<a class="sourceLine" id="cb1-236" data-line-number="236">  counter <span class="ot">&lt;-</span> newIORef M.empty</a>
<a class="sourceLine" id="cb1-237" data-line-number="237">  <span class="kw">let</span> config <span class="fu">=</span> <span class="dt">Config</span> counter (TL.pack prefixArg)</a>
<a class="sourceLine" id="cb1-238" data-line-number="238">      runR reader <span class="fu">=</span> runReaderT reader config</a>
<a class="sourceLine" id="cb1-239" data-line-number="239">  scottyT <span class="dv">3000</span> runR app</a>
<a class="sourceLine" id="cb1-240" data-line-number="240">  <span class="co">-- runR ~ (m Response -&gt; IO Response) ~ (ReaderT Config IO Response -&gt; IO Response)</span></a>
<a class="sourceLine" id="cb1-241" data-line-number="241">  <span class="co">--                                     ~ ReaderT (config -&gt; IO Response)</span></a>
<a class="sourceLine" id="cb1-242" data-line-number="242">  <span class="co">-- app ~ Scotty () ~ ScottyT e m () ~ ScottyT Text (ReaderT Config IO) ()</span></a>
<a class="sourceLine" id="cb1-243" data-line-number="243"></a>
<a class="sourceLine" id="cb1-244" data-line-number="244"><span class="ot">spec ::</span> <span class="dt">SpecWith</span> ()</a>
<a class="sourceLine" id="cb1-245" data-line-number="245">spec <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-246" data-line-number="246">  describe <span class="st">&quot;EitherT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-247" data-line-number="247">    testBatch <span class="fu">$</span> functor (undefined<span class="ot"> ::</span> <span class="dt">EitherT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-248" data-line-number="248">    testBatch <span class="fu">$</span> applicative (undefined<span class="ot"> ::</span> <span class="dt">EitherT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-249" data-line-number="249">    testBatch <span class="fu">$</span> monad (undefined<span class="ot"> ::</span> <span class="dt">EitherT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-250" data-line-number="250">    it <span class="st">&quot;swapEitherT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-251" data-line-number="251">      swapEitherT (<span class="dt">EitherT</span> (<span class="dt">Just</span> (<span class="dt">Right</span> <span class="dv">3</span>))) <span class="ot">`shouldBe`</span></a>
<a class="sourceLine" id="cb1-252" data-line-number="252">        <span class="dt">EitherT</span> (<span class="dt">Just</span> (<span class="dt">Left</span> <span class="dv">3</span><span class="ot"> ::</span> <span class="dt">Either</span> <span class="dt">Int</span> <span class="dt">String</span>))</a>
<a class="sourceLine" id="cb1-253" data-line-number="253">      swapEitherT (<span class="dt">EitherT</span> (<span class="dt">Just</span> (<span class="dt">Left</span> <span class="st">&quot;hi&quot;</span>))) <span class="ot">`shouldBe`</span></a>
<a class="sourceLine" id="cb1-254" data-line-number="254">        <span class="dt">EitherT</span> (<span class="dt">Just</span> (<span class="dt">Right</span> <span class="st">&quot;hi&quot;</span><span class="ot"> ::</span> <span class="dt">Either</span> <span class="dt">Int</span> <span class="dt">String</span>))</a>
<a class="sourceLine" id="cb1-255" data-line-number="255">    it <span class="st">&quot;eitherT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-256" data-line-number="256">      eitherT</a>
<a class="sourceLine" id="cb1-257" data-line-number="257">        (\a <span class="ot">-&gt;</span> <span class="dt">Just</span> (a <span class="fu">++</span> <span class="st">&quot;world&quot;</span>))</a>
<a class="sourceLine" id="cb1-258" data-line-number="258">        (<span class="dt">Just</span> <span class="fu">.</span> show <span class="fu">.</span> (<span class="fu">+</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1-259" data-line-number="259">        (<span class="dt">EitherT</span> (<span class="dt">Just</span> (<span class="dt">Right</span> <span class="dv">3</span>))) <span class="ot">`shouldBe`</span></a>
<a class="sourceLine" id="cb1-260" data-line-number="260">        <span class="dt">Just</span> <span class="st">&quot;5&quot;</span></a>
<a class="sourceLine" id="cb1-261" data-line-number="261">      eitherT</a>
<a class="sourceLine" id="cb1-262" data-line-number="262">        (\a <span class="ot">-&gt;</span> <span class="dt">Just</span> (a <span class="fu">++</span> <span class="st">&quot;world&quot;</span>))</a>
<a class="sourceLine" id="cb1-263" data-line-number="263">        (<span class="dt">Just</span> <span class="fu">.</span> show <span class="fu">.</span> (<span class="fu">+</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1-264" data-line-number="264">        (<span class="dt">EitherT</span> (<span class="dt">Just</span> (<span class="dt">Left</span> <span class="st">&quot;hello&quot;</span>))) <span class="ot">`shouldBe`</span></a>
<a class="sourceLine" id="cb1-265" data-line-number="265">        <span class="dt">Just</span> <span class="st">&quot;helloworld&quot;</span></a>
<a class="sourceLine" id="cb1-266" data-line-number="266">  describe <span class="st">&quot;ReaderT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-267" data-line-number="267">    testBatch <span class="fu">$</span> functor (undefined<span class="ot"> ::</span> <span class="dt">ReaderT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-268" data-line-number="268">    testBatch <span class="fu">$</span> applicative (undefined<span class="ot"> ::</span> <span class="dt">ReaderT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-269" data-line-number="269">    testBatch <span class="fu">$</span> monad (undefined<span class="ot"> ::</span> <span class="dt">ReaderT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-270" data-line-number="270">  describe <span class="st">&quot;StateT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-271" data-line-number="271">    testBatch <span class="fu">$</span> functor (undefined<span class="ot"> ::</span> <span class="dt">StateT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-272" data-line-number="272">    testBatch <span class="fu">$</span> applicative (undefined<span class="ot"> ::</span> <span class="dt">StateT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-273" data-line-number="273">    testBatch <span class="fu">$</span> monad (undefined<span class="ot"> ::</span> <span class="dt">StateT</span> <span class="dt">String</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-274" data-line-number="274">  describe <span class="st">&quot;Lift More&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-275" data-line-number="275">    it <span class="st">&quot;can lift to EitherT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-276" data-line-number="276">      lift (<span class="dt">Just</span> <span class="dv">1</span>) <span class="ot">`shouldBe`</span></a>
<a class="sourceLine" id="cb1-277" data-line-number="277">        <span class="dt">EitherT</span> (<span class="dt">Just</span> <span class="fu">$</span> <span class="dt">Right</span> <span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Maybe</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-278" data-line-number="278">      lift <span class="dt">Nothing</span> <span class="ot">`shouldBe`</span> <span class="dt">EitherT</span> (<span class="dt">Nothing</span><span class="ot"> ::</span> <span class="dt">Maybe</span> (<span class="dt">Either</span> <span class="dt">String</span> <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb1-279" data-line-number="279">    it <span class="st">&quot;can lift to ReaderT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-280" data-line-number="280">      runReaderT (lift <span class="fu">$</span> <span class="dt">Just</span> <span class="dv">1</span>) <span class="st">&quot;hi&quot;</span> <span class="ot">`shouldBe`</span> <span class="dt">Just</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-281" data-line-number="281">      runReaderT (lift <span class="dt">Nothing</span>) <span class="st">&quot;hi&quot;</span> <span class="ot">`shouldBe`</span> (<span class="dt">Nothing</span><span class="ot"> ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb1-282" data-line-number="282">    it <span class="st">&quot;can lift to StateT&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-283" data-line-number="283">      runStateT (lift <span class="fu">$</span> <span class="dt">Just</span> <span class="dv">1</span>) <span class="st">&quot;hi&quot;</span> <span class="ot">`shouldBe`</span> <span class="dt">Just</span> (<span class="dv">1</span>, <span class="st">&quot;hi&quot;</span>)</a>
<a class="sourceLine" id="cb1-284" data-line-number="284">      runStateT (lift <span class="dt">Nothing</span>) <span class="st">&quot;hi&quot;</span> <span class="ot">`shouldBe`</span> (<span class="dt">Nothing</span><span class="ot"> ::</span> <span class="dt">Maybe</span> (<span class="dt">Int</span>, <span class="dt">String</span>))</a>
<a class="sourceLine" id="cb1-285" data-line-number="285">  describe <span class="st">&quot;Chapter Exercises&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-286" data-line-number="286">    it <span class="st">&quot;rDec decrements&quot;</span> <span class="fu">$</span> fmap (runReaderT rDec) [<span class="dv">1</span> <span class="fu">..</span> <span class="dv">10</span>] <span class="ot">`shouldBe`</span> [<span class="dv">0</span> <span class="fu">..</span> <span class="dv">9</span>]</a>
<a class="sourceLine" id="cb1-287" data-line-number="287">    it <span class="st">&quot;rShow shows&quot;</span> <span class="fu">$</span> fmap (runReaderT rShow) [<span class="dv">1</span> <span class="fu">..</span> <span class="dv">10</span>] <span class="ot">`shouldBe`</span> <span class="dt">Identity</span> <span class="fu">.</span></a>
<a class="sourceLine" id="cb1-288" data-line-number="288">      show <span class="fu">&lt;$&gt;</span></a>
<a class="sourceLine" id="cb1-289" data-line-number="289">      [<span class="dv">1</span> <span class="fu">..</span> <span class="dv">10</span>]</a>
<a class="sourceLine" id="cb1-290" data-line-number="290">    it <span class="st">&quot;rPrintAndInc prints and increments&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-291" data-line-number="291">      nums <span class="ot">&lt;-</span> traverse (runReaderT rPrintAndInc) [<span class="dv">1</span> <span class="fu">..</span> <span class="dv">10</span>]</a>
<a class="sourceLine" id="cb1-292" data-line-number="292">      nums <span class="ot">`shouldBe`</span> [<span class="dv">2</span> <span class="fu">..</span> <span class="dv">11</span>]</a>
<a class="sourceLine" id="cb1-293" data-line-number="293">    it <span class="st">&quot;sPrintAndAccum prints and accumulates&quot;</span> <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-294" data-line-number="294">      states <span class="ot">&lt;-</span> mapM (runStateT sPrintAndAccum) [<span class="dv">1</span> <span class="fu">..</span> <span class="dv">5</span>]</a>
<a class="sourceLine" id="cb1-295" data-line-number="295">      states <span class="ot">`shouldBe`</span> [(<span class="st">&quot;1&quot;</span>, <span class="dv">2</span>), (<span class="st">&quot;2&quot;</span>, <span class="dv">3</span>), (<span class="st">&quot;3&quot;</span>, <span class="dv">4</span>), (<span class="st">&quot;4&quot;</span>, <span class="dv">5</span>), (<span class="st">&quot;5&quot;</span>, <span class="dv">6</span>)]</a></code></pre></div>
        </div>
        <div id="footer">
            Site generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
